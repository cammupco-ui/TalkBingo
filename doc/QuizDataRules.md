# TalkBingo Quiz Data Generation Rules

이 문서는 `BalanceQuizData.csv`와 `TruthQuizData.csv`의 분석을 바탕으로, TalkBingo의 퀴즈 데이터 관리 규칙을 정의합니다.

---

## 1. 밸런스 게임 (Balance Quiz) 규칙

밸런스 게임은 두 가지 선택지 중 하나를 선택해야 하는 게임입니다.

### 1.1 데이터 구조 (CSV Structure)
| 컬럼명 | 설명 | 예시 | 비고 |
| --- | --- | --- | --- |
| `CodeName` | 타겟팅 코드 | `F-F-B-Ar-L1, F-F-Fa-*-L1` | **콤마(,)로 구분하여 다중 타겟 지정 가능**. 관계 생성을 위한 태그 정보 |
| `Order` | 정렬 순서 | `B25-00001` | **csv파일에서 데이터 신규, 수정점검 후 저장되는 번호. 관리 편의를 위한 번호. 이 order의 일련 번호에 여러개의 CodeName 정보가 있을 수 있음.** |
| `q_id` | 고유 ID | `B25-00001` | **`Order`와 동일한 값 사용**. (Legacy ID) |
| `content` | 질문 내용 | `탕수육 먹는 스타일은?` | 상황이나 선택의 기준을 제시 |
| `choice_a` | 선택지 A | `부먹` | 짧고 명확한 텍스트 |
| `choice_b` | 선택지 B | `찍먹` | A와 대립되거나 비교되는 텍스트 |

### 1.2 콘텐츠 관리 가이드라인
1.  **대립성 (Conflict)**: 두 선택지는 명확하게 구분되어야 하며, 선택이 고민될수록 좋은 질문입니다.
2.  **간결성 (Conciseness)**: 선택지는 가능한 짧게(단어 또는 짧은 구) 작성합니다. 질문 본문에서 상황을 충분히 설명합니다.
3.  **다양성 (Variety)**:
    *   **가치관형**: "돈 vs 명예", "과정 vs 결과"
    *   **취향형**: "부먹 vs 찍먹", "여름 vs 겨울"
    *   **상황형**: "평생 폰 없이 살기, 평생 친구 없이 살기"

### 1.3 최적의 관리 조건 (Optimization Rules)
질문(`content`)과 선택지(`choice_a`, `choice_b`)를 생성할 때 다음 조건을 준수해야 합니다.1. 

#### A. 질문 내용 (`content`)
*   **몰입감 (Immersive)**: 단순한 질문보다는 구체적인 상황을 부여하여 몰입감을 높입니다.
    *   *Bad*: "어떤 초능력을 원해?"
    *   *Good*: "내일 당장 초능력을 얻을 수 있다면, 당신의 선택은?"
*   **명확한 기준 (Clear Criteria)**: 선택의 기준이 모호하지 않도록 상황을 한정합니다.
    *   *Bad*: "누가 더 나빠?"
    *   *Good*: "절친이 내 애인과 바람났을 때, 더 용서할 수 없는 사람은?"
*   **간결함 (Concise)**: 모바일 화면(빙고 타일)에 최적화되도록 **30자 이내**를 권장합니다.

#### B. 선택지 (`choice_a`, `choice_b`)
*   **상호 배타적 (Mutually Exclusive)**: 두 선택지는 겹치지 않고 확실하게 대립되어야 합니다.
*   **길이 균형 (Length Balance)**: 두 선택지의 텍스트 길이를 비슷하게 맞춰 시각적 균형을 유지합니다.
*   **명확한 트레이드오프 (Clear Trade-off)**: 하나를 얻으면 하나를 잃는 구조가 가장 이상적입니다.
    *   *Example*: "평생 두통 (육체적 고통)" vs "평생 흉터 (심미적 손해)"

4.  **톤앤매너 (Tone & Manner) - 친밀도별 가이드**
    친밀도(Intimacy Level)에 따라 질문의 깊이와 수위를 조절하여, 관계 발전에 자연스럽게 기여해야 합니다.

    *   **L1 (어색한 사이)**: **"탐색 & 취향"**
        *   **주제**: 음식, 여행, 취미, MBTI, 가벼운 일상.
        *   **톤**: 예의 바르고 부담 없는 질문. 호불호 위주.
        *   **예시**: "찍먹 vs 부먹", "휴가 때 가고 싶은 곳은?"

    *   **L2 (조금 편해진 사이)**: **"경험 & 공감"**
        *   **주제**: 학창 시절, 직장 생활 소소한 에피소드, 주말 계획.
        *   **톤**: 공감대를 형성할 수 있는 경험 공유.
        *   **예시**: "학창 시절 가장 기억남는 선생님은?", "주말에 주로 하는 일은?"

    *   **L3 (스스럼 없는 사이)**: **"가치관 & 생각"**
        *   **주제**: 연애관(가벼운), 돈에 대한 생각, 성격의 장단점.
        *   **톤**: 서로의 생각을 궁금해하고 의견을 나누는 질문.
        *   **예시**: "연인과 연락 문제로 싸운다면?", "로또 1등 되면 뭐 할거야?"

    *   **L4 (고민을 공유하는 사이)**: **"속마음 & 감정"**
        *   **주제**: 현재의 고민, 과거의 후회, 미래의 불안, 깊은 연애관.
        *   **톤**: 진지한 이야기를 꺼낼 수 있는 신뢰 기반 질문.
        *   **예시**: "요즘 가장 힘든 점은?", "다시 돌아가고 싶은 순간이 있다면?"

    *   **L5 (비밀을 지켜주는 사이)**: **"비밀 & 본질"**
        *   **주제**: 남들에게 말 못 할 비밀, 트라우마, 인생의 목표, 19금(선택적).
        *   **톤**: 가장 솔직하고 가감 없는 대화.
        *   **예시**: "내 인생 최악의 흑역사는?", "절대 용서할 수 없는 행동은?"

---

## 2. 진실 게임 (Truth Quiz) 규칙

진실 게임은 서로에 대해 깊이 알아가기 위한 서술형/대화형 질문입니다.

### 2.1 데이터 구조 (CSV Structure)
| 컬럼명 | 설명 | 예시 | 비고 |
| --- | --- | --- | --- |
| `CodeName` | 타겟팅 코드 | `M-F-B-Ar-L2` | **콤마(,)로 구분하여 다중 타겟 지정 가능**. 관계 생성을 위한 태그 정보 |
| `Order` | 정렬 순서 | `T25-00001` | **csv파일에서 데이터 신규, 수정점검 후 저장되는 번호.** |
| `q_id` | 고유 ID | `T25-00001` | **`Order`와 동일한 값 사용**. (Legacy ID) |
| `content` | 질문 내용 | `가장 기억에 남는 여행지는?` | 대화를 유도하는 열린 질문 |
| `answers` | 답변 예시 | `파리, 뉴욕, 제주도` | 콤마(,)로 구분된 키워드 또는 예시 문장 |

### 2.2 콘텐츠 관리 가이드라인
1.  **개방성 (Open-ended)**: "예/아니오"로 끝나는 질문보다는 "이유는?", "언제?", "무엇을?" 등 이야기를 끌어내는 질문을 지향합니다.
2.  **답변 가이드 (Answer Guide)**: `answers` 컬럼은 정답이 아니라, 사용자가 답변할 때 참고할 수 있는 **키워드**나 **예시**를 제공합니다.
3.  **카테고리 (Category)**:
    *   **과거/경험**: "학창 시절 흑역사는?", "가장 후회되는 일은?"
    *   **가치관/생각**: "사랑이란 무엇이라고 생각하나요?", "성공의 기준은?"
    *   **미래/상상**: "10년 뒤 내 모습은?", "로또 1등이 된다면?"
    *   **취향/선호**: "가장 좋아하는 음식은?", "힐링하는 방법은?"

### 2.3 최적의 관리 조건 (Optimization Rules)
질문(`content`)과 답변 가이드(`answers`)를 생성할 때 다음 조건을 준수해야 합니다.

#### A. 질문 내용 (`content`)
*   **서술형 유도 (Open-ended)**: "예/아니오"로 끝나는 닫힌 질문을 피하고, 이야기를 끌어낼 수 있는 질문이어야 합니다.
    *   *Bad*: "여행 좋아해?"
    *   *Good*: "가장 기억에 남는 여행지와 그 이유는?"
*   **구체적 상황 (Specific Context)**: 막연한 질문보다는 구체적인 상황이나 조건을 제시하여 답변을 돕습니다.
    *   *Bad*: "행복이 뭐야?"
    *   *Good*: "최근 일주일 중 가장 행복했던 순간은 언제였어?"
*   **감정 터치 (Emotional Engagement)**: 단순한 사실 확인보다는 감정이나 생각을 묻는 질문이 대화를 깊게 만듭니다.
    *   *Example*: "그때 어떤 기분이 들었어?", "가장 설렜던 순간은?"

#### B. 답변 가이드 (`answers`)
*   **다양한 예시 (Variety)**: 답변이 한 방향으로 쏠리지 않도록 다양한 관점의 키워드를 제공합니다.
    *   *Example*: "성취감, 휴식, 맛있는 음식, 사람들과의 대화"
*   **가이드 역할 (Guidance)**: 정답을 강요하는 것이 아니라, "이런 식으로 대답하면 돼"라는 힌트를 줍니다.
*   **키워드 중심 (Keyword-based)**: 문장보다는 핵심 단어 위주로 나열하여 사용자가 빠르게 스캔할 수 있게 합니다.

---

## 3. CodeName 규칙 (Targeting Logic)

모든 퀴즈 데이터는 `CodeName`을 통해 타겟팅 대상을 정의합니다.

**Format**: `[MP]-[CP]-[IR]-[SubRel]-[Intimacy]`

*   **MP (Main Player Gender)**: `M` (남성), `F` (여성)
*   **CP (Co-Player Gender)**: `M` (남성), `F` (여성)
*   **IR (Intimate Relationship)**:
    *   `B`: Friend (친구)
    *   `Fa`: Family (가족)
    *   `Lo`: Lover (연인)
*   **SubRel (Sub Relation Code)**:
    *   **Friend (B)**:
        *   `Ar`: 고향친구 (Area) - 태어난 지역이 비슷한 친구
        *   `Sc`: 학교친구 (School) - 초/중/고/대 동창
        *   `Or`: 직장동료 (Organization) - 회사/조직 동료
        *   `Dc`: 동네친구 (Distance) - 현재 접속지역이 비슷한 친구
    *   **Family (Fa)**:
        *   `Br`: 형제 (Brother) / `Si`: 자매 (Sister)
        *   `Sb`: 누나-남동생 / `Bs`: 오빠-여동생 (남매)
        *   `Co`: 사촌 (Cousin)
        *   `Gp`: 조부모-손자녀 (Grandparent)
        *   `Fs`/`Md`...: 부모-자녀 (Father-Son, Mother-Daughter, etc)
    *   **Lover (Lo)**:
        *   `Sw`: 애인 (Sweet) - 연애 중인 사이
        *   `Hw`: 부부 (Husband-Wife) - 결혼한 사이
*   **Intimacy (Level)**:
    *   `L1`: 처음 알게 된 사이 (초면/어색함)
    *   `L2`: 조금 편해진 사이 (탐색/경험공유)
    *   `L3`: 스스럼 없는 사이 (친함/일상공유)
    *   `L4`: 고민을 공유하는 사이 (매우친함/신뢰)
    *   `L5`: 깊은 신뢰의 사이 (영혼의단짝/비밀공유)

---

## 4. 질문 매칭 로직 (Fallback Logic)

사용자의 프로필과 정확히 일치하는 질문이 없을 경우, 다음과 같은 **계층형 검색(Cascading Match)** 로직을 통해 가장 적절한 질문을 찾아냅니다.

### 4.1 문제점 (Problem)
기존의 **정확 일치(Exact Match)** 방식은 데이터가 조금만 부족해도 질문이 나오지 않는 문제가 발생합니다.
*   **User**: `남-여-친구-동네친구-L3` (`M-F-B-Dc-L3`)
*   **DB**: `남-여-친구-*-L3` (모든 친구에게 적용 가능한 질문)
*   **Result**: 일치하지 않음 (`Dc` != `*`) -> **질문 없음 (Empty Screen)**

### 4.2 해결책: Fallback Hierarchy
시스템은 다음 4단계 우선순위로 질문을 탐색하여, 하나라도 매칭되면 해당 질문을 제공합니다.

1.  **1순위: 정확 일치 (Exact Match)**
    *   Code: `M-F-B-Dc-L3`
    *   설명: 특정 관계(동네친구)와 특정 레벨(L3)에 딱 맞는 맞춤형 질문.
2.  **2순위: 관계 확장 (Generic Sub-Relation)**
    *   Code: `M-F-B-*-L3`
    *   설명: 만난 계기(동네/학교)와 상관없이, **친구 사이의 L3 레벨**이면 통하는 질문.
3.  **3순위: 레벨 확장 (Generic Intimacy)**
    *   Code: `M-F-B-*-*`
    *   설명: 친밀도와 상관없이, **친구**라면 물어볼 수 있는 질문.
4.  **4순위: 광범위 (Broad)**
    *   Code: `*-*-*-*-*`
    *   설명: 누구에게나 할 수 있는 범용 질문. (안전망)

---

## 5. 실전 데이터 관리 프로세스 (Data Pipeline)

우리는 **"엑셀에서 관리하고, 스크립트로 한 번에 서버로 올리는"** 효율적인 방식을 사용합니다.

### 1단계: 엑셀(CSV)로 질문 만들기 📝
*   기획자는 복잡한 데이터베이스를 직접 건드릴 필요가 없습니다.
*   **엑셀 파일**에 질문, 선택지, 그리고 타겟팅 코드(`CodeName`)만 규칙에 맞춰 작성하세요.
*   파일: `BalanceQuizData.csv` (밸런스게임), `TruthQuizData.csv` (진실게임)

### 2단계: 파이썬 스크립트 실행 (자동 변환 및 업로드) ⚙️
*   `import_supabase.py` 스크립트가 엑셀 파일과 서버 사이의 다리 역할을 합니다.
*   **자동 처리되는 작업**:
    1.  **ID 자동 부여**: 질문마다 고유 관리 번호(`q_id`)를 붙여줍니다. (예: `B25-001`)
    2.  **데이터 검증**: 입력한 `CodeName`이 규칙에 맞는지 검사하여 오타를 방지합니다.
    3.  **포맷 변환**: 엑셀 데이터를 앱이 이해할 수 있는 데이터 형식(JSON)으로 변환합니다.

### 3단계: Supabase(서버) 저장 및 활용 ☁️
*   변환된 데이터는 서버의 **`questions` 테이블**에 안전하게 저장됩니다.
*   특히 `CodeName`은 **태그(Array)** 형태로 저장되어, 앱에서 "20대 여성 친구 질문만 보여줘"와 같은 검색을 매우 빠르고 정확하게 수행할 수 있습니다.

**✨ 요약: 엑셀에 적고 -> 스크립트 돌리면 -> 앱에 바로 반영됩니다!**
