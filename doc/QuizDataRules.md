# TalkBingo Quiz Data Generation Rules

이 문서는 `BalanceQuizData.csv`와 `TruthQuizData.csv`의 분석을 바탕으로, TalkBingo의 퀴즈 데이터 관리 규칙을 정의합니다.

---

## 0. ID 생성 규칙 (ID Generation Rules)

모든 퀴즈 및 게임 데이터는 아래의 ID 포맷을 엄격히 따릅니다.

| 퀴즈 타입 | 약어 | ID 생성 포맷 (Type + Year + Seq) | 예시 (2026년 첫 번째 데이터) |
| --- | --- | --- | --- |
| 밸런스 퀴즈 (Balance Quiz) | `B` | `B + YY + - + 00001` | `B26-00001` |
| 진실 게임 (Truth Game) | `T` | `T + YY + - + 00001` | `T26-00001` |
| 미니 게임 (Mini Game) | `M` | `M + YY + - + 00001` | `M26-00001` |

---

## 1. 밸런스 게임 (Balance Quiz) 규칙

밸런스 게임은 두 가지 선택지 중 하나를 선택해야 하는 게임입니다.

### 1.1 데이터 구조 (CSV Structure)
| 컬럼명 | 설명 | 예시 | 비고 |
| --- | --- | --- | --- |
| `CodeName` | 타겟팅 코드 | `*-*-B-Ar-L1` | **Wildcard 사용 (`*-*`)**. 성별 무관, 타겟팅 전용 태그 |
| `Order` | 관리 코드 | `BDcL3-00001` | **(Semantic)** 대분류소분류친밀도-순번(5자리). 식별 용도. |
| `q_id` | 시스템 ID | `B26-00001` | **(System)** 타입+연도-전체순번. 불변의 고유키 (PK). |
| `content` | 질문 내용 (기본) | `탕수육 먹는 스타일은?` | 상황이나 선택의 기준을 제시 (기본형) |
| `var_m_f` | 남->여 변형 | `누나는 탕수육 먹을 때...` | (Optional) 특정 성별 조합 시 텍스트 |
| `var_f_m` | 여->남 변형 | `오빠는 탕수육 먹을 때...` | (Optional) 특정 성별 조합 시 텍스트 |
| `var_m_m` | 남->남 변형 | `형은 탕수육 먹을 때...` | (Optional) 특정 성별 조합 시 텍스트 |
| `var_f_f` | 여->여 변형 | `언니는 탕수육 먹을 때...` | (Optional) |
| `content_en` | 질문 (영어) | `What is your style for Tangsuyuk?` | **(New)** English Content |
| `var_m_f_en` | 남->여 (영어) | `Noona, when you eat...` | **(New)** English Variant |
| `var_f_m_en` | 여->남 (영어) | `Oppa, when you eat...` | **(New)** English Variant |
| `var_m_m_en` | 남->남 (영어) | `Hyung, when you eat...` | **(New)** English Variant |
| `var_f_f_en` | 여->여 (영어) | `Unnie, when you eat...` | **(New)** English Variant |
| `choice_a` | 선택지 A | `부먹` | 짧고 명확한 텍스트 |
| `choice_b` | 선택지 B | `찍먹` | A와 대립되거나 비교되는 텍스트 |
| `choice_a_en` | 선택지 A (영어) | `Pouring Sauce` | **(New)** English Choice |
| `choice_b_en` | 선택지 B (영어) | `Dipping Sauce` | **(New)** English Choice |

### 1.2 콘텐츠 관리 가이드라인
1.  **대립성 (Conflict)**: 두 선택지는 명확하게 구분되어야 하며, 선택이 고민될수록 좋은 질문입니다.
2.  **간결성 (Conciseness)**: 선택지는 가능한 짧게(단어 또는 짧은 구) 작성합니다. 질문 본문에서 상황을 충분히 설명합니다.
3.  **다양성 (Variety)**:
    *   **가치관형**: "돈 vs 명예", "과정 vs 결과"
    *   **취향형**: "부먹 vs 찍먹", "여름 vs 겨울"
    *   **상황형**: "평생 폰 없이 살기, 평생 친구 없이 살기"

### 1.3 최적의 관리 조건 (Optimization Rules)
질문(`content`)과 선택지(`choice_a`, `choice_b`)를 생성할 때 다음 조건을 준수해야 합니다.1. 

#### A. 질문 내용 (`content`)
*   **몰입감 (Immersive)**: 단순한 질문보다는 구체적인 상황을 부여하여 몰입감을 높입니다.
    *   *Bad*: "어떤 초능력을 원해?"
    *   *Good*: "내일 당장 초능력을 얻을 수 있다면, 당신의 선택은?"
*   **명확한 기준 (Clear Criteria)**: 선택의 기준이 모호하지 않도록 상황을 한정합니다.
    *   *Bad*: "누가 더 나빠?"
    *   *Good*: "절친이 내 애인과 바람났을 때, 더 용서할 수 없는 사람은?"
*   **간결함 (Concise)**: 모바일 화면(빙고 타일)에 최적화되도록 **30자 이내**를 권장합니다.

#### B. 선택지 (`choice_a`, `choice_b`)
*   **상호 배타적 (Mutually Exclusive)**: 두 선택지는 겹치지 않고 확실하게 대립되어야 합니다.
*   **길이 균형 (Length Balance)**: 두 선택지의 텍스트 길이를 비슷하게 맞춰 시각적 균형을 유지합니다.
*   **명확한 트레이드오프 (Clear Trade-off)**: 하나를 얻으면 하나를 잃는 구조가 가장 이상적입니다.
    *   *Example*: "평생 두통 (육체적 고통)" vs "평생 흉터 (심미적 손해)"

4.  **톤앤매너 (Tone & Manner) - 친밀도별 가이드**
    친밀도(Intimacy Level)에 따라 질문의 깊이와 수위를 조절하여, 관계 발전에 자연스럽게 기여해야 합니다.

    *   **L1 (어색한 사이)**: **"탐색 & 취향"**
        *   **주제**: 음식, 여행, 취미, MBTI, 가벼운 일상.
        *   **톤**: 예의 바르고 부담 없는 질문. 호불호 위주.
        *   **예시**: "찍먹 vs 부먹", "휴가 때 가고 싶은 곳은?"

    *   **L2 (조금 편해진 사이)**: **"경험 & 공감"**
        *   **주제**: 학창 시절, 직장 생활 소소한 에피소드, 주말 계획.
        *   **톤**: 공감대를 형성할 수 있는 경험 공유.
        *   **예시**: "학창 시절 가장 기억남는 선생님은?", "주말에 주로 하는 일은?"

    *   **L3 (스스럼 없는 사이)**: **"가치관 & 생각"**
        *   **주제**: 연애관(가벼운), 돈에 대한 생각, 성격의 장단점.
        *   **톤**: 서로의 생각을 궁금해하고 의견을 나누는 질문.
        *   **예시**: "연인과 연락 문제로 싸운다면?", "로또 1등 되면 뭐 할거야?"

    *   **L4 (고민을 공유하는 사이)**: **"속마음 & 감정"**
        *   **주제**: 현재의 고민, 과거의 후회, 미래의 불안, 깊은 연애관.
        *   **톤**: 진지한 이야기를 꺼낼 수 있는 신뢰 기반 질문.
        *   **예시**: "요즘 가장 힘든 점은?", "다시 돌아가고 싶은 순간이 있다면?"

    *   **L5 (비밀을 지켜주는 사이)**: **"비밀 & 본질"**
        *   **주제**: 남들에게 말 못 할 비밀, 트라우마, 인생의 목표, 19금(선택적).
        *   **톤**: 가장 솔직하고 가감 없는 대화.
        *   **예시**: "내 인생 최악의 흑역사는?", "절대 용서할 수 없는 행동은?"

---

## 2. 진실 게임 (Truth Quiz) 규칙

진실 게임은 서로에 대해 깊이 알아가기 위한 서술형/대화형 질문입니다.

### 2.1 데이터 구조 (CSV Structure)
| 컬럼명 | 설명 | 예시 | 비고 |
| --- | --- | --- | --- |
| `CodeName` | 타겟팅 코드 | `*-*-Fa-*-L1` | **Wildcard 사용**. 성별 무관, 관계/친밀도 기준 |
| `Order` | 관리 코드 | `TFaL1-00001` | **(Semantic)** T(Truth)가족(Fa)L1-순번. |
| `q_id` | 시스템 ID | `T26-00001` | **(System)** T(Truth)+26년-전체순번. |
| `content` | 질문 내용 (기본) | `본인이 생각하는 자신의 장점은?` | 자신에 대해 이야기할 수 있는 질문 |
| `var_m_f` | 남->여 변형 | `누나랑 갔던 여행 중...` | (Optional) |
| `var_f_m` | 여->남 변형 | `오빠랑 갔던 여행 중...` | (Optional) |
| `var_m_m` | 남->남 변형 | `형이랑 갔던 여행 중...` | (Optional) |
| `var_f_f` | 여->여 변형 | `언니랑 갔던 여행 중...` | (Optional) |
| `content_en` | 질문 (영어) | `What is your most memorable trip?` | **(New)** English Content |
| `var_m_f_en` | 남->여 (영어) | `Noona, among your trips...` | **(New)** English Variant |
| `var_f_m_en` | 여->남 (영어) | `Oppa, among your trips...` | **(New)** English Variant |
| `var_m_m_en` | 남->남 (영어) | `Hyung, among your trips...` | **(New)** English Variant |
| `var_f_f_en` | 여->여 (영어) | `Unnie, among your trips...` | **(New)** English Variant |
| `answers` | 답변 예시 | `파리, 뉴욕, 제주도` | 콤마(,)로 구분된 키워드 |
| `answers_en` | 답변 예시 (영) | `Paris, NYC, Jeju` | **(New)** English Answers |

### 2.2 콘텐츠 관리 가이드라인
1.  **개방성 (Open-ended)**: "예/아니오"로 끝나는 질문보다는 "이유는?", "언제?", "무엇을?" 등 이야기를 끌어내는 질문을 지향합니다.
2.  **답변 가이드 (Answer Guide)**: `answers` 컬럼은 정답이 아니라, 사용자가 답변할 때 참고할 수 있는 **키워드**나 **예시**를 제공합니다.
3.  **카테고리 (Category)**:
    *   **과거/경험**: "학창 시절 흑역사는?", "가장 후회되는 일은?"
    *   **가치관/생각**: "사랑이란 무엇이라고 생각하나요?", "성공의 기준은?"
    *   **미래/상상**: "10년 뒤 내 모습은?", "로또 1등이 된다면?"
    *   **취향/선호**: "가장 좋아하는 음식은?", "힐링하는 방법은?"

### 2.3 최적의 관리 조건 (Optimization Rules)
질문(`content`)과 답변 가이드(`answers`)를 생성할 때 다음 조건을 준수해야 합니다.

#### A. 질문 내용 (`content`)
*   **서술형 유도 (Open-ended)**: "예/아니오"로 끝나는 닫힌 질문을 피하고, 이야기를 끌어낼 수 있는 질문이어야 합니다.
    *   *Bad*: "여행 좋아해?"
    *   *Good*: "가장 기억에 남는 여행지와 그 이유는?"
*   **구체적 상황 (Specific Context)**: 막연한 질문보다는 구체적인 상황이나 조건을 제시하여 답변을 돕습니다.
    *   *Bad*: "행복이 뭐야?"
    *   *Good*: "최근 일주일 중 가장 행복했던 순간은 언제였어?"
*   **감정 터치 (Emotional Engagement)**: 단순한 사실 확인보다는 감정이나 생각을 묻는 질문이 대화를 깊게 만듭니다.
    *   *Example*: "그때 어떤 기분이 들었어?", "가장 설렜던 순간은?"

#### B. 답변 가이드 (`answers`)
*   **다양한 예시 (Variety)**: 답변이 한 방향으로 쏠리지 않도록 다양한 관점의 키워드를 제공합니다.
    *   *Example*: "성취감, 휴식, 맛있는 음식, 사람들과의 대화"
*   **가이드 역할 (Guidance)**: 정답을 강요하는 것이 아니라, "이런 식으로 대답하면 돼"라는 힌트를 줍니다.
*   **키워드 중심 (Keyword-based)**: 문장보다는 핵심 단어 위주로 나열하여 사용자가 빠르게 스캔할 수 있게 합니다.

---

## 3. CodeName 규칙 (Targeting Logic)

모든 퀴즈 데이터는 `CodeName`을 통해 타겟팅 대상을 정의합니다.

**Format**: `*-*-[IR]-[SubRel]-[Intimacy]`

*   **MP/CP (Gender Slots)**: 항상 `*` (Wildcard) 사용. 성별 구분은 `gender_variants` 컬럼에서 처리합니다.
*   **IR (Intimate Relationship)**:
    *   `B`: Friend (친구)
    *   `Fa`: Family (가족)
    *   `Lo`: Lover (연인)
*   **SubRel (Sub Relation Code)**:
    *   `Ar`, `Sc`, `Or`, `Dc` ... (기존 동일)
*   **Intimacy (Level)**: `L1` ~ `L5` (기존 동일)

> **Note**: 기존의 `M-F` 와 같은 명시적 성별 코드는 더 이상 타겟팅 키로 사용하지 않습니다. 모든 질문은 동적 변형을 전제로 합니다.

---

## 4. 동적 변형 시스템 (Dynamic Variant System)

### 4.1 문제 해결 (Solution)
기존의 성별 고정 방식(`M-F`)은 데이터 파편화를 야기했습니다. 새로운 시스템은 **단일 소스 멀티 렌더링** 방식을 사용합니다.

### 4.2 작동 방식
1.  **Fetch**: 앱은 **성별과 무관하게** 관계(`Ar`)와 친밀도(`L3`)만으로 질문을 검색합니다. (쿼리: `*-*-B-Ar-L3`)
2.  **Adapt**: 게임 화면에서 턴이 바뀔 때마다, 현재 **화자(Speaker)**와 **청자(Listener)**의 성별을 클라이언트가 판단합니다.
3.  **Render**: `content` 대신 적절한 `var_X_to_Y` 텍스트를 우선적으로 표시합니다.
    *   `M -> F`: `var_m_f` ("누나...", "동생아...")
    *   `F -> M`: `var_f_m` ("오빠...", "너...")
    *   `Fallback`: 변형 텍스트가 비어있다면(`null`) 기본 `content`를 표시합니다.

---

### 4.4 생성 제약 사항 (Generation Constraints)

퀴즈 데이터를 생성하거나 관리할 때 다음 제약 사항을 준수해야 합니다.

1.  **임의 코드 생성 금지**: 정의된 관계 코드(`Ar`, `Sc`, `Or`, `Dc`, `Br`, `Si` 등) 외에 새로운 코드를 임의로 생성하지 않습니다.
2.  **레벨 준수**: 친밀도 레벨은 `L1` ~ `L5` 사이의 값만 사용합니다.
3.  **성별 필드 필수**: CodeName 작성 시 MP와 CP 자리를 비우지 않습니다. (성별 무관일 경우 `*`를 명시적으로 작성)
4.  **관계 코드 필수**: CodeName에 관계 코드가 누락되어서는 안 됩니다. (범용 질문이라도 `B-*` 형태 등으로 명시)


---

## 5. 실전 데이터 관리 프로세스 (Data Pipeline)

우리는 **"엑셀에서 관리하고, 스크립트로 한 번에 서버로 올리는"** 효율적인 방식을 사용합니다.

### 1단계: 엑셀(CSV)로 질문 만들기 📝
*   기획자는 복잡한 데이터베이스를 직접 건드릴 필요가 없습니다.
*   **엑셀 파일**에 질문, 선택지, 그리고 타겟팅 코드(`CodeName`)만 규칙에 맞춰 작성하세요.
*   파일: `BalanceQuizData.csv` (밸런스게임), `TruthQuizData.csv` (진실게임)

### 2단계: 파이썬 스크립트 실행 (자동 변환 및 업로드) ⚙️
*   `import_supabase.py` 스크립트가 엑셀 파일과 서버 사이의 다리 역할을 합니다.
*   **자동 처리되는 작업**:
    1.  **ID 자동 부여**: 질문마다 고유 관리 번호(`q_id`)를 붙여줍니다. (예: `B26-00001`)
    2.  **데이터 검증**: 입력한 `CodeName`이 규칙에 맞는지 검사하여 오타를 방지합니다.
    3.  **포맷 변환**: 엑셀 데이터를 앱이 이해할 수 있는 데이터 형식(JSON)으로 변환합니다.

### 3단계: Supabase(서버) 저장 및 활용 ☁️
*   변환된 데이터는 서버의 **`questions` 테이블**에 안전하게 저장됩니다.
*   특히 `CodeName`은 **태그(Array)** 형태로 저장되어, 앱에서 "20대 여성 친구 질문만 보여줘"와 같은 검색을 매우 빠르고 정확하게 수행할 수 있습니다.

**✨ 요약: 엑셀에 적고 -> 스크립트 돌리면 -> 앱에 바로 반영됩니다!**
