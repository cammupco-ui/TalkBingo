# TalkBingo 보안 및 개인정보 보호 계획 (Security & Privacy Plan)

본 문서는 TalkBingo의 **결제 시스템 보안**과 **사용자 개인정보 보호**를 위한 포괄적인 전략 및 실행 가이드입니다. 서비스 신뢰도 확보와 법적 규정 준수를 목표로 합니다.

---

## 1. 결제 시스템 보안 (Payment Security)

결제 데이터는 가장 민감한 정보이므로, **"직접 저장하지 않는다"**를 제1원칙으로 삼습니다.

### 1-1. PCI-DSS 규정 준수 전략
PG사 및 앱스토어의 보안 인프라를 100% 위임하여 활용합니다.

*   **원칙**: TalkBingo 서버(Supabase)에는 **카드 번호, 유효기간, CVC 등 민감한 결제 정보를 절대 저장하지 않습니다.**
*   **구현**:
    *   **앱 (IAP)**: Apple/Google의 인앱 결제 모듈을 사용하며, TalkBingo는 오직 **`purchase_token` (영수증 토큰)**만 저장하여 유효성을 검증합니다.
    *   **웹 (PG)**: 포트원(PortOne) 등의 SDK를 사용하며, 결제창은 PG사가 제공하는 보안 페이지(iframe/popup)에서 실행됩니다. 서버에는 **`imp_uid` (결제 고유 ID)**만 저장합니다.

### 1-2. 위변조 및 어뷰징 방지
*   **영수증 검증 (Receipt Validation)**:
    *   클라이언트(앱)가 보낸 결제 성공 메시지를 그대로 믿지 않습니다.
    *   반드시 **Supabase Edge Function**이 해당 토큰을 가지고 Apple/Google/PG사 서버에 직접 조회하여 **"실제 결제된 건인지"** 더블 체크합니다.
*   **중복 처리 방지 (Idempotency)**:
    *   모든 결제 요청에 **`request_id`**를 부여하여, 네트워크 오류로 인해 같은 요청이 두 번 들어와도 포인트가 중복 지급되지 않도록 DB단에서 차단합니다.
*   **재시도 공격 방지 (Replay Attack Prevention)**:
    *   한 번 사용된 `purchase_token`은 DB에 기록(`used_tokens` 테이블)하여, 재사용을 원천 봉쇄합니다.

---

## 2. 개인정보 보호 및 데이터 보안 (Data Privacy)

사용자 정보를 최소한으로 수집하고, 철저히 격리하며, 암호화하여 보호합니다.

### 2-1. 데이터 수집 최소화 (Data Minimization)
*   **회원가입**: 구글 로그인(OAuth)을 통해 **이메일 주소, 기본 프로필 사진** 등 필수 정보만 수집합니다. 비밀번호는 아예 저장하지 않습니다 (Google 인증 위임).
*   **가상 정보 사용**: 게임 중 사용되는 성별, 나이, 지역 정보는 **"게임용 페르소나"**로 취급하며, 실명 인증 정보와 분리하여 저장합니다.

### 2-2. 데이터 접근 제어 (RLS - Row Level Security)
Supabase의 강력한 RLS 정책을 적용하여, 물리적으로 데이터 접근을 통제합니다.

*   **본인 데이터**: 오직 `auth.uid() == user_id`인 사용자 본인만 자신의 프로필, 결제 내역, 포인트 정보를 읽고 쓸 수 있습니다.
*   **친구 데이터**: 게임 상대로 지정된 경우에만(Friend Relation 성립), 상대방의 **퍼블릭 프로필(닉네임, 아바타)**만 `SELECT` 할 수 있습니다. 이메일 등 민감 정보는 접근 불가합니다.
*   **관리자 접근**: 서비스 운영자라 하더라도 DB 직접 접속을 차단하고, 로그 기록이 남는 **별도 관리자 대시보드**를 통해서만 최소한의 정보에 접근합니다.

### 2-3. 데이터 암호화 (Encryption)
*   **전송 구간 암호화 (TLS/SSL)**: 클라이언트 ↔ 서버 간 모든 통신은 **HTTPS**로 암호화됩니다.
*   **저장 데이터 암호화**: Supabase(PostgreSQL)는 디스크 레벨 암호화(TDE)를 지원합니다.
*   **민감 필드 관리**: 혹시 모를 로깅 시에도 이메일, 전화번호 등은 마스킹(`j***@gmail.com`) 처리하여 로그에 남지 않도록 합니다.

---

## 3. 개인정보 유출 방지 대책 (Breach Prevention)

### 3-1. 인증 보안 강화
*   **JWT 토큰 관리**: `Access Token`의 유효 기간을 짧게 설정하고, `Refresh Token`은 안전한 스토리지(Flutter Secure Storage)에만 보관합니다.
*   **세션 관리**: 비정상적인 로그인 시도(IP 변경, 다중 접속 등) 감지 시 자동으로 세션을 만료시키고 재로그인을 요구합니다.

### 3-2. 익명성 보장 (Anonymity)
*   **익명 유저**: 앱 최초 실행 시 생성되는 익명 계정은 기기 고유 ID 등을 수집하지 않고, 오직 **UUID**로만 식별합니다. 앱 삭제 시 연결 고리는 영구적으로 끊어집니다.
*   **잊혀질 권리 (회원 탈퇴)**: 사용자가 탈퇴 요청 시, 즉시 `Soft Delete` 처리하고, 7일(법적 보존 기간 제외) 후 DB에서 영구 삭제(`Hard Delete`)하는 자동화 잡(Cron Job)을 운영합니다.

---

## 4. 서비스 데이터 및 AI 활용 정책 (Service Data & AI Policy)

사용자가 궁금해하는 "채팅, 게임 기록의 활용 범위"에 대한 명확한 정의입니다. 이 데이터는 서비스의 핵심(질문 추천, 관계 분석)을 위해 필요하지만, 철저한 익명화 원칙 하에 관리됩니다.

### 4-1. 데이터의 분류 (Classification)
*   **개인정보 (PII - 민감정보)**:
    *   이메일, 프로필 사진, 실명(있을 경우).
    *   👉 **정책**: 암호화 저장, 외부 유출 절대 금지, AI 학습에 **사용 안 함**.
*   **서비스 데이터 (Service Data - 행동정보)**:
    *   게임 내 답변(Answer), 선택한 선택지(Choice), 획득한 점수.
    *   채팅 로그(Chat Logs).
    *   👉 **정책**: 서비스 개선 및 AI 모델 학습 목적으로 **활동 가능**하나, 반드시 **익명화(Anonymization)** 전처리를 거쳐야 함.

### 4-2. 수집 및 활용 범위 (Scope of Utilization)
회사는 다음의 목적을 위해서만 서비스 데이터를 수집 및 분석합니다. (이용약관 동의 필요)

1.  **맞춤형 질문 추천 (Curation)**:
    *   "이 유저는 '여행' 주제를 좋아하네?" → 다음 게임에서 여행 관련 밸런스 게임 추천.
2.  **관계 분석 리포트 (Relationship Report)**:
    *   "두 분의 대화 긍정도가 80%네요!" → 게임 종료 후 제공되는 분석 리포트 생성.
3.  **질문 퀄리티 개선 (QA)**:
    *   유저들이 자주 건너뛰거나 거부하는 질문 식별 및 삭제.

### 4-3. AI 학습 시 익명화 원칙 (Anonymization for AI)
AI(LLM) 학습이나 분석을 위해 데이터를 파이프라인으로 보낼 때는 다음 규칙을 엄수합니다.

1.  **식별자 제거 (De-identification)**:
    *   `user_id`, `email`, `nickname` 등 사용자를 특정할 수 있는 모든 필드를 제거하거나 해시(Hash) 처리합니다.
2.  **엔티티 마스킹 (Entity Masking)**:
    *   채팅 내용 중 전화번호, 이메일, 주소 패턴이 발견되면 자동으로 `[MASKED]` 처리합니다.
3.  **데이터 분리 (Data Segregation)**:
    *   AI 학습용 데이터셋(Dataset)은 운영 DB(Production DB)와 물리적으로 분리된 별도 저장소(Data Lake)에서 관리됩니다.

### 4-4. 미래 AI 시스템을 위한 데이터 거버넌스 (Governance for Future AI)
`doc/AI_SUPABASE_INTEGRATION.md`에 명시된 고도화된 AI(개인화, 지속 학습) 도입 시 다음 원칙이 추가 적용됩니다.

1.  **벡터 DB 보안 (Vector DB Security)**:
    *   유저 성향 분석을 위해 생성되는 임베딩(Vector) 데이터에도 `user_id`를 직접 매핑하지 않고, 난수화된 **`persona_id`**를 사용하여 역추적을 방지합니다.
2.  **학습 데이터 수명 주기 (ILM)**:
    *   개인화 서비스 향상을 위해 수집된 행동 데이터는 **최대 3년** 후 파기되거나, 통계적 수치로만 영구 보관됩니다.
3.  **통제권 보장 (User Control)**:
    *   유저는 언제든지 **"내 행동 데이터를 AI 학습에 사용하지 마세요"** (Opt-out)를 설정 메뉴에서 선택할 수 있으며, 이 경우 기본 추천 알고리즘만 적용됩니다.

---

## 5. 보안 사고 대응 프로세스 (Incident Response)

만약의 사태에 대비한 대응 매뉴얼입니다.

1.  **감지 (Detection)**: DB 이상 트래픽(대량 조회 등) 감지 시 알람 발송.
2.  **차단 (Containment)**: 의심 IP 및 해당 유저 계정 즉시 차단 (Kill Switch).
3.  **조사 (Investigation)**: 접속 로그 및 트랜잭션 로그 분석.
4.  **복구 (Recovery)**: 백업 데이터 시점 복원 (PITR).
5.  **통지 (Notification)**: 개인정보 유출 확인 시 24시간 내 이용자 및 관계 기관 신고 (법적 의무).

---

## 6. 요약: 이것만은 꼭 지킵니다

1.  **결제 정보는 절대 저장하지 않는다.** (토큰만 저장)
2.  **유저 데이터는 본인만 볼 수 있다.** (RLS 강제)
3.  **통신은 무조건 암호화한다.** (HTTPS)
4.  **과도한 정보는 수집하지 않는다.** (최소 수집 원칙)
